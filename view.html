
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
<head> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<title>Stage Reservation App</title> 

<script src="http://code.jquery.com/jquery-latest.js"></script>
<script src="http://saran93.zxq.net/lib/date.js"></script>
<script type="text/javascript" src="http://saran93.zxq.net/lib/monthpicker.min.js"></script>
<script type="text/javascript">

function addRowOld(dateFrom,dateTo, stageId, specName, specId, dateReserved)
{

         if (!document.getElementsByTagName) return;
         tabBody=document.getElementsByClassName("reservationTable").item(0);
         row=document.createElement("TR");
		 
		 row.innerHTML = '<td>' + dateFrom + '</td>'
							+ '<td>' + dateTo + '</td>'
							+ '<td>' + stageId + '</td>'
							+ '<td>' + specName + '</td>'
							+ '<td>' + specId + '</td>'
							+ '<td>' + dateReserved + '</td>';		          
		 
         tabBody.appendChild(row);
}

function addRow(row)
{

         if (!document.getElementsByTagName) return;
         tabBody= document.getElementById("reservationTable");
		 //alert(tabBody);
         rowElement=document.createElement("tr");

		 
		 rowHTML = '';
		 for(field in row)
		 {
			//if(row[field].hasOwnProperty(field))
				if(row[field] != row.reservation_id)
					rowHTML = rowHTML + '<td>' + row[field] + '</td>'
			
		 }
		 
		 rowElement.innerHTML = rowHTML;		 	          
		 
         tabBody.appendChild(rowElement);
}

function populateTable(monthSelected, stageArray)
{
	$.getJSON('http://saran93.zxq.net/display.php', function(table) {

		//need to get month to display from user
		var objMonth = new Date(monthSelected);
		var objMonthEnd = new Date(monthSelected);
		//daysInMonth = Date.getDaysInMonth(objMonth.getFullYear(), objMonth.getMonth());
		daysPerMonth = DaysInMonth(objMonth.getFullYear(), objMonth.getMonth());
		
		objMonthEnd.setDate(objMonthEnd.getDate()+ daysPerMonth);
		
		//alert(stageArray);alert(daysPerMonth);
		
		//for(idx = 1; idx <= daysPerMonth; idx++ )
		for(var day = objMonth; day < objMonthEnd; day.setDate(day.getDate()+1) )
		{
			ary = new Array(objMonth.toString("MMMM"), day.getDate());
			specNameAry = new Array();
			
			
			
			//populating spaces in specNameAry
			for(item in stageArray)
				specNameAry.push("");
			//loop through reservation table
			for(row in table)
			{
				//alert(day + '#' + table[row].date_reserved_from + '#' + table[row].date_reserved_to);
				var dateFrom = new Date(table[row].date_reserved_from);
				var dateTo = new Date(table[row].date_reserved_to);
				
				//current day is within stage reserved period
				if(day >= dateFrom && day <= dateTo)
				{
					//find stage name in stageArry, use index to add spec name to ary
					for(var stageIndex = 0; stageIndex < stageArray.length; stageIndex++)
					{
						if(table[row].stage_name.toLowerCase() == stageArray[stageIndex].toLowerCase())
							//specNameAry[stageIndex] = table[row].spec_name ;
							specNameAry[stageIndex] = table[row].spec_id ;
					}
					//ary.push(table[row].stage_name);
				}
			}

			//push content from specNameAry into ary
			for(idx = 0; idx <  specNameAry.length; idx++)
				ary.push( specNameAry[idx] );
			
			addRow(ary)
		}
		
		//while(objDateFrom < objDateTo)
		//{
		//	alert(objDateFrom.getDate());
		//	ary = new Array(date, objDateFrom.getDate(), "pro1", "pro2", "pro3", "pro4", "pro5", "pro6");
		//	addRow2(ary)
		//	objDateFrom.setDate(objDateFrom.getDate()+1);
		//}
		
		//need to add a check that date is not null
		
		//ary = new Array(date, "day", "pro1", "pro2", "pro3", "pro4", "pro5", "pro6");
		
		//addRow2(ary)
		//for(row in table)
		//{
		//	addRow2(table[row])
		//}
		
	});
}

function getTableDataOriginal()
{
	$.getJSON('http://saran93.zxq.net/display.php', function(table) {
		alert(table.length); //this should alert 'value1'
		
		for(row in table)
		{
			addRow(table[row].date_reserved_from, table[row].date_reserved_to, table[row].stage_name, table[row].spec_name, table[row].spec_id, table[row].date_reserved)
		}
		
	});
}


function createTable(monthSelected)
{

	if (!document.getElementsByTagName) return;

	tableDiv=document.getElementById("tableDiv");
	//alert(tableDiv);
	table = document.createElement("table");
	//table = createElement("table");
	
	table.setAttribute('border','2');
	table.setAttribute('id','reservationTable');
	
	//clear the div
	emptyDiv(tableDiv)
	
	
	$.getJSON('http://saran93.zxq.net/displayStage.php', function(stages) {
		
		headings = new Array("Date", "Day");
		stageArray = new Array();
		
		for(stage in stages)
		{
			headings.push(stages[stage].name);
			stageArray.push(stages[stage].name);
		}
		
		rowHTML = '';	
		for(title in headings)
			rowHTML = rowHTML + '<th>' + headings[title] + '</th>';
		
		table.innerHTML = '<tbody><tr>' + rowHTML + '</tr></tbody>';
		tableDiv.appendChild(table);
		
		populateTable(monthSelected, stageArray);		
	});
	
	
}

function date()
{
	var objDate = new Date("10/11/2009");
	alert(objDate.toString("MMMM"));
}




$(function(){		

		$("#example_2").monthpicker("2012-12",callback);		
		
	});
	
function callback(data,$e){
	var str = "";
	for(key in data) {
		str += " " + key + ": " + data[key]+ "; ";
	}
	
	
	
	monthSelected = data["year"] + '-' + '0' + data["month"] + '-' + "01";
	alert(monthSelected);
	createTable(monthSelected);
}

function emptyDiv (divToClear){
	var i;
	while (i=divToClear.childNodes[0])
	{
		if (i.nodeType == 1 || i.nodeType == 3)
		{
			divToClear.removeChild(i);
		}
	}		
}

function createElement (elementName)
{
	return '<' + elementName + '></' + elementName + '>';
}

function DaysInMonth(y,m) { return new Date(y,m,0).getDate(); }

</script>

<link rel="stylesheet" href="http://saran93.zxq.net/css/monthpicker.css" type="text/css" charset="utf-8" />

 
    <script type="text/javascript" src="http://o.aolcdn.com/dojo/1.0/dojo/dojo.xd.js"
        djConfig="parseOnLoad: true"></script>
 
    <script type="text/javascript">
        dojo.require("dijit.form.DateTextBox");
    </script>

</head> 

<body> 





<button onClick='createTable("2012-07-01");return false;'>
create table</button>
</br>
<div class="MonthPicker" id="example_2" style="width:780px;" title="Example 2">Month Picker v2</div>
<div id="tableDiv"></div>


</body> 
</html>